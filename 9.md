# Chapter 9. 더 큰 설계 문제.

- 그동안 Profile클래스를 리팩토링 했음. Profile클래스는 회사 또는 인물 정보를 추적하고 관리하며 시간이 지나면서 많이 바뀔 수 있으며 더 많은 정보가 추가되거나 몇가지 정보는 제거 / 변경 될 수 있음.

- Profie클래스는 점수 합산을 도와주는 메소드를 가지고 있음. 

**프로필 클래스는 객체지향 클래스 설계의 SRP(단일 책임 원칙. 클래스를 변경할 때는 단 한가지 이유만 있어야 한다. SRP를 잘 지키면 변경으로 인한 리스크는 줄어듬)을 위반하고 있음.**

- 클래스에 더 많은 책임이 존재할수록 클래스에 있는 코드를 변경할 때, 기존의 다른 동작들을 깨기 쉽다. 클래스가 하나의 책임만 가지면 재활용 되기 쉽다.

## 명령-질의 분리

- 어떤 값을 반환하고 부작용을 발생시키는(시스템에 있는 어떤 클래스 / 엔티티의 상태변경). 메소드는 명령-질의 분리(command-query separation)원칙을 위반.
- 명령-질의 분리(command-query separation)원칙 : 어떤 메소드는 명령을 실행(부작용을 생성하는 어떤 작업을 함)하거나 질의에 대답(어떤 값 반환) 할 수 있으며, 두 작업을 **모두**하면 안된다.
- 왜냐면 질의 메소드가 객체 상태를 바꾸면, 그 메소드를 두 번 호출하는것이 불가능할 수도 있기 때문. 혹은 두번쨰 호출하면 바라지않은 방향으로 객체 상태가 변질될 수 있음.

## 단위 테스트의 유지보수 비용

- 리팩토링은 코드 동작을 변경하지 않고 코드 구현을 바꾸는 활동임. 테스트는 그 “동작”을 반영함.  하지만 현실은 클래스의 “동작”을 변경하고 있음. 
- 즉 이렇게 되면 테스트가 깨지게 되는데, 실패하는테스트의 정도를 부정적인 설계 지표로 인식하는 것도 좋음. 더 많은 테스트가 “동시에” 깨질 수록 더욱더 많은 설계 문제가 있는 것.

### 자신을 보호하는 방법,.

- 여러 테스트에 걸친 코드 중복은 가장 큰 설계문제. <p>
  
1 . 테스트를 따르기가 어려움.<p>
2. 작은 코드 조각들을 단일 메소드로 추출하면, 그 코드 조각들을 변경해야 할 때 미치는 영향을 최소화 할 수 있음. <p>
  
**단위 테스트를 설정하는데 코드가 몇십줄 필요하다면 그것은 시스템 설계에 문제가 있다는 것**

SRP를 위반하면 클래스는 점점커지고, 다른 클래스에 대한 의존성이 커지고, 테스트를 설정하는데 더 많은 노력이 요구됨. 즉 커다란 클래스를 분리해야한다!

- 앞에서도 나온 내용이지만, private메소드(구현 세부 사항)를 테스트하려는 충동은 클래스가 필요 이상으로 커졌다는 또다른 힌트. private메소드가 자꾸 늘어나면 내부 동작을 새 클래스로 옮기고 public으로 만드는것이 좋음. 메소드가 public이 되면 그에 대한 테스트를 작성 할 수 있으므로 동작을 문서화하는 것이 된다. 
- 단위 테스트가 어려워보인다는것도 좋은 힌트임. 설계를 개선하여 테스트를 쉽게 유지하셈. 

> 설계를 지속적으로 개선해 나가는 자신감을 키우기 위해 단위테스트의 커버리지를 높혀라!

